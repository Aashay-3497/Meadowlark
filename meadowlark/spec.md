# Meadowlark AI Powered Conservation Investment Platform

## Overview
Meadowlark is a conservation investment platform that helps users discover investment opportunities based on environmental impact and AI-powered research. The application guides users through a multi-step investment form and presents personalized investment recommendations with detailed environmental and economic scoring using real-time data from AWS Bedrock AI, enhanced with real-time biodiversity and climate data for accurate scoring calculations.

## Core Features

### Investment Discovery Form
- Multi-step form collecting user investment preferences:
  - Target geographic region selection
  - Investment amount input
  - SDG (Sustainable Development Goals) selection from Goals 2, 6, 7, 13, 14, 15
  - Risk tolerance selection (low/medium/high)
  - Investment horizon timeframe
  - Minimum expected return percentage

### AI-Powered Investment Recommendations with Real-Time Scoring
- Display investment opportunities generated by AWS Bedrock AI based on user preferences
- Each opportunity includes:
  - Real-time calculated conservation score based on GBIF biodiversity data and climate stability metrics
  - Real-time calculated economic score based on Open-Meteo climate data and environmental resilience factors
  - Detailed breakdown of environmental impact metrics derived from actual biodiversity and climate data
  - Investment summary and key highlights
  - Real URLs and verifiable sources from AI research
  - External investment link for direct access to opportunity
- Investment data dynamically generated through backend integration with AWS Bedrock Runtime API using Amazon Nova Premier AI model
- Backend ensures 2-6 verified investment opportunities are returned per query with all required fields specified
- Opportunities must include title, url, location, description, sdg_alignment, estimated_return, region, and verification_source fields
- Real-time score calculation using integrated GBIF and Open-Meteo APIs for each opportunity location

### Real-Time Data Integration and Score Calculation
- GBIF API integration to fetch biodiversity data for each investment opportunity location
- Open-Meteo API integration to fetch climate data for each investment opportunity location
- Conservation score calculation based on:
  - Total species count from GBIF data
  - Threatened species density and biodiversity richness indicators
  - Ecosystem stability metrics derived from species distribution
- Economic score calculation based on:
  - Climate trends and temperature stability from Open-Meteo data
  - Precipitation patterns and agricultural viability indicators
  - Environmental resilience factors for long-term investment sustainability
- Graceful handling of partial or missing API data while continuing to display available metrics
- Automatic location-based API calls for each investment opportunity during backend processing
- Climate-based field structure used throughout the platform for consistent data terminology

### Investment Opportunity Actions
- "Invest Now" button for each investment opportunity that opens the external investment website
- Button is always enabled when a valid `url` field is present in the opportunity data
- Button dynamically links to the opportunity's URL property using `target="_blank"` and `rel="noopener noreferrer"` for secure external navigation
- Automatically adds `https://` protocol to URLs missing protocol for safety
- Maintains compatibility with existing translations across all supported languages

### Language Translation
- Translation dropdown feature allowing users to select between English, Spanish, French, and Mandarin
- Dropdown displayed persistently in the main interface (header or top-right corner)
- Dynamic text and label updates based on selected language using translation mappings
- Default language is English
- Translation applies to all major UI text elements including:
  - Titles and subtitles
  - Button labels ("Continue", "Back", "Calculate Scores", "Invest Now", etc.)
  - Form labels and input placeholders
  - Investment results section text including real-time score displays
- Compact and accessible design with appropriate language indicators

### User Interface
- Clean, nature-inspired design with gradient backgrounds
- Smooth animated transitions between form steps
- Responsive layout using Tailwind CSS
- Lucide React icons for visual elements
- TypeScript implementation with functional components and hooks
- Statistical display elements for "Projects Worldwide," "Capital Deployed," and "Hectares Protected" are removed from the platform
- Layout remains visually balanced after removal of these statistical components
- UI consistently displays 2-6 verified investment opportunities with functional "Invest Now" buttons
- Real-time score displays showing calculated conservation and economic scores with data source indicators

### Additional Features
- "New Search" functionality to reset the form and start over
- Real-time AI-powered investment opportunity discovery
- Graceful error handling for AI service failures with user-friendly fallback messages
- Real-time biodiversity and climate data integration with fallback handling for API failures

## Technical Implementation

### Backend
- Backend API endpoint that receives user investment preferences from the frontend form
- Direct integration with AWS Bedrock Runtime API using `@aws-sdk/client-bedrock-runtime` package
- Bedrock client configured with:
  - AWS region: us-east-2
  - HTTPS requests directly to AWS Bedrock endpoint
  - API key authentication via environment variable `AWS_BEDROCK_API_KEY`
  - Model: amazon.nova-premier-v1:0
- Dynamic prompt construction based on user inputs (region, SDG goals, risk tolerance, investment horizon, minimum expected return)
- Enhanced prompt generation logic explicitly specifying all required fields for valid investment opportunities:
  - title (required, non-empty string)
  - url (required, valid URL format)
  - location (required, geographic coordinates or location name)
  - description (required, detailed investment description)
  - sdg_alignment (required, alignment with selected SDG goals)
  - estimated_return (required, expected return percentage)
  - region (required, geographic region)
  - verification_source (required, credible source for verification)
- Backend processes form data and constructs adaptive prompts for Bedrock to ensure 2-6 opportunities are returned with all required fields
- Direct HTTPS API calls to Bedrock Runtime with proper text decoding and JSON response parsing
- Enhanced Bedrock response parsing logic with systematic validation:
  - Accepts broader range of valid structures including arrays of objects and non-standard JSON keys
  - Primary extraction from `outputText` and `content[0].text` fields
  - Secondary regex-based extraction for JSON embedded in text or markdown
  - Automatic conversion of truncated or malformed responses into valid JSON arrays
  - Handling of wrapped text responses and incomplete JSON objects
  - Multiple parsing attempts with progressive fallback strategies
  - Advanced normalization to handle Bedrock's inconsistent formatting
- Flexible response validation with comprehensive field requirements:
  - Validates that all required fields are present in each opportunity
  - Accepts opportunities that might not include all secondary details but validates available ones
  - Data type validation and conversion for all investment opportunity fields
  - Ensures all responses with required fields are passed to frontend
  - Validates that 2-6 opportunities with complete required fields are extracted and returned
- GBIF API integration for real-time biodiversity data retrieval:
  - Fetch species occurrence data based on investment opportunity location coordinates
  - Aggregate species data to calculate total species count and biodiversity indicators
  - Extract threatened species information and calculate conservation metrics
  - Handle API rate limits and partial data responses gracefully
- Open-Meteo API integration for real-time climate data retrieval:
  - Fetch historical and current climate data for investment opportunity locations
  - Calculate average temperature trends and precipitation patterns
  - Derive climate stability and agricultural viability indicators
  - Process weather data to support economic scoring calculations
- Real-time score calculation engine:
  - Conservation score computation using GBIF biodiversity data and ecosystem stability metrics
  - Economic score computation using Open-Meteo climate data and environmental resilience factors
  - Graceful handling of missing or partial API data while maintaining score calculation functionality
  - Integration of calculated scores into investment opportunity objects before frontend delivery
  - Climate-based field structure used consistently throughout score calculations
- Global replacement of all "ndvi" references with "climate" terminology throughout the codebase
- Proper handling of different content-types from Bedrock HTTP responses (`application/json`, `application/octet-stream`)
- UTF-8 decoding for response content when required
- Enhanced error handling with detailed logging while maintaining operation continuity
- Secure handling of AWS credentials through environment variables with no hardcoded keys
- Appropriate authentication headers included in all AWS Bedrock requests
- Backend stores user investment preferences and AI-generated recommendations with calculated real-time scores
- Backend canister must be operational and properly configured for HTTP outcalls to AWS Bedrock, GBIF, and Open-Meteo APIs

### Canister Management and Cycle Allocation
- Backend canister (`pq4fb-uaaaa-aaaad-aascq-cai`) requires sufficient cycle allocation to handle AWS Bedrock API requests
- Automatic cycle replenishment system to prevent `IC0406: out of cycles` errors during API operations
- Cycle monitoring and management to ensure continuous availability for external HTTP calls
- Proper canister restart procedures to restore functionality after cycle depletion
- Cycle allocation must account for the computational cost of AWS Bedrock, GBIF, and Open-Meteo API calls

### AWS Bedrock Integration Reliability
- Robust retry logic for AWS Bedrock API calls to handle temporary failures
- Exponential backoff strategy for failed requests to prevent overwhelming the service
- Comprehensive error handling for various AWS Bedrock response scenarios
- Validation of secure HTTPS connections to AWS Bedrock endpoints
- Consistent delivery of valid investment opportunity data through enhanced parsing and validation
- Proper handling of AWS Bedrock credential validation and model configuration
- Monitoring and logging of AWS Bedrock API call success rates and response quality

### Frontend
- React application with TypeScript implementation
- Updated data layer (useQueries.ts and hooks) to call backend API with comprehensive response validation
- Enhanced response parsing in useQueries.ts with systematic validation requirements:
  - Primary JSON deserialization with error handling
  - Secondary validation for embedded or wrapped JSON content
  - Comprehensive field validation requiring all specified fields
  - Enhanced parsing to correctly extract and validate 2-6 investment opportunities per query
  - Proper handling of `url` field from AWS Bedrock responses
  - Automatic protocol addition (`https://`) for URLs missing protocol
- Enhanced React Query hook implementation:
  - Validates opportunities meet comprehensive schema requirements (all required fields)
  - Treats opportunities with available details as displayable with functional "Invest Now" buttons
  - Ensures 2-6 opportunities with required fields are displayed
  - Handles real-time calculated conservation and economic scores from backend
- State management handled through React hooks
- Translation mappings stored in frontend localization object with English as primary language
- Integration with backend to fetch AI-generated investment opportunities with real-time calculated scores
- Dynamic display of real-time investment data from AI research enhanced with GBIF and Open-Meteo data
- Apollo Client integration maintained for additional data sources
- Response data parsing and mapping to InvestmentOpportunity objects with comprehensive field requirements:
  - title (required, non-empty string)
  - url (required, valid URL format with automatic protocol addition)
  - location (required, geographic information)
  - description (required, detailed investment description)
  - sdg_alignment (required, SDG alignment information)
  - estimated_return (required, expected return data)
  - region (required, geographic region)
  - verification_source (required, credible verification source)
  - conservationScore (calculated in real-time using GBIF data)
  - economicScore (calculated in real-time using Open-Meteo data)
- Global replacement of all "ndvi" references with "climate" terminology throughout the frontend codebase
- Enhanced error handling with improved user feedback while accepting available data
- InvestmentResults component displays 2-6 opportunities with required fields and real-time calculated scores
- InvestmentResults component includes enhanced "Invest Now" button functionality:
  - Button is always enabled when a valid `url` field is present
  - Button dynamically links to opportunity's URL property with automatic protocol addition
  - Opens external links with `target="_blank"` and `rel="noopener noreferrer"`
  - Compatible with existing translation system for button text
  - Proper fallback handling for Bedrock's inconsistent formatting
  - Graceful display of opportunities with available details
- Real-time score display components showing calculated conservation and economic scores with data source indicators using climate-based terminology

### AI Integration
- Backend constructs dynamic prompts incorporating user input values from form
- Direct AWS Bedrock Runtime API integration for real-time investment opportunity generation
- Enhanced prompt template integration specifying all required fields for personalized investment recommendations
- Real-time processing of user preferences to generate personalized investment recommendations with complete field sets
- Integration of AI-generated opportunities with existing scoring and display systems
- Enhanced response normalization pipeline with systematic validation ensuring comprehensive data format delivery
- Comprehensive JSON response parsing with regex-based secondary extraction for embedded content
- Advanced handling of Bedrock's inconsistent output formatting (extra text, markdown, malformed JSON)
- Full end-to-end validation from backend Bedrock calls to frontend display of 2-6 opportunities with all required fields
- Systematic extraction and validation of required fields with comprehensive field handling for each opportunity
- Integration with GBIF and Open-Meteo APIs to enhance AI-generated opportunities with real-time calculated scores using climate-based terminology

### Real-Time Data APIs
- GBIF API integration for biodiversity data retrieval and conservation score calculation
- Open-Meteo API integration for climate data retrieval and economic score calculation
- Automatic location-based API calls for each investment opportunity
- Graceful handling of API failures and partial data responses
- Real-time score calculation and integration into investment opportunity objects
- Backend storage of calculated scores alongside AI-generated investment recommendations
- Climate-based field structure used consistently throughout all API integrations and data processing
